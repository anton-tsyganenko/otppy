otppy
=====

реализация шифра "одноразовый блокнот", написанная на python  

##опции

Опции для запуска файла otp.py:

`-o file`, `--output-file=file` - направить вывод в файл  
`-i file`, `--input-file=file` - получить данные из файла  
`-k folder`, `--keys-folder=folder` - взять ключ из папки  
`-I mode`, `--input-mode=mode` - режим ввода данных (`b64` - данные в base64, `bin` - бинарные данные или `auto` - автоматически (по умолчанию))  
`-O mode`, `--output-mode=mode` - режим вывода данных (`b64` - данные в base64, `bin` - бинарные данные или `auto` - автоматически (по умолчанию))  
`-c action`, `--hash=action` - использовать контрольную сумму (`add` - для добавления (при зашифровывании)  или `check` - для проверки (при расшифровывании), `auto` - автоматически (по умолчанию), `no` - не использовать (не рекомендуется))  
`-z action`, `--zip=action` - `compress`(`c`) - сжать или `decompress`(`d`) - восстановить данные. `no` - не использовать, `auto` - не сжимать данные при шифровании, но восстановить их, если они определяются как сжатые (по умолчанию).  
`-a algorithm`, `--compress-algorithm=algorithm` - алгоритм сжатия данных, `gzip` (по умолчанию) или `bzip2`.  
`-K`, `--key-action action` - действия с использованным ключем (варианты: `leave` - оставить, `delete` - удалить, `shred` - надежно удалить, `rename` - переименовать, чтобы пометить как использованный)  

##генерация ключей:

Для генерации ключей используйте команду `./keygen.py <папка>
<количество_ключей> <длина_ключей> [t]`.  Перед этим поместите в используемую
папку разных файлов, которые будут использовании при генерации. Рекомендуется
использовать свои файлы, которые ранее нигде не публиковались, например, можно
использовать неудачные фотографии, видеозаписи, текстовые документы. Суммарный
размер файлов должен в несколько раз превышать суммарный размер необходимых
ключей. После генерации файлы удалятся.

##быстрый старт

Если вы уже получили ключи, пропустите 1 и 2 пункты.

1. Создайте 2 набора ключей, как показано в главе выше. Рекомендуется создать
   100-10000 ключей размером 100-10000 байт, в зависимости от потребностей. Если
   создавать слишком много ключей или делать их слишком длинными, могут
   возникнуть такие проблемы, как долгая генерация/шифрование или большой объем
   занимаемых данных. Если связь односторонняя, можете сделать только одну папку
   с ключами или сделать маленькую 2 папку на случай необходимости передачи
   сообщения.
2. Передайте эту папку своему собеседнику по **защищенному** каналу. Перед этим
   можете упаковать ее в архив без сжатия.
3. Чтобы передать собеседнику сообщение, используйте команду `./otp.py -k
   you_to_interlocutor`. Введите свое сообщение, после этого нажмите enter а
   затем ctrl+d. Передайте собеседнику полученные данные.
4. Чтобы расшифровать полученное сообщение, используйте команду `./otp.py -k
   interlocutor_to_you`. Введите код, после этого нажмите enter.
5. Следите за количеством оставшихся ключей. Оно равно количеству файлов
   (исключая файлы, кончающиеся на "_used") в папке с ключами. Когда ключи
   закончатся, повторите 1 и 2 пункты.

##примеры

генерация папки с 100 ключами по 10 КБ:

    ./keygen.py keys 10 10000

преобразование (шифрование/расшифровывание) с ручным вводом текста и ключа:

    ./otp.py

шифрование с использованием bzip2-сжатия:

    ./otp.py -z c -a bzip2

преобразование с ручным вводом текста и ключа и добавлением контрольной суммы:

    ./otp.py -c add

преобразование с ручным вводом текста и использованием ключа из папки:

    ./otp.py -k keys

преобразование файла с использованием ключа из папки:

    ./otp.py -k keys -i file.in -o file.out

##также

- Настоятельно рекомендуется создать 2 комплекта ключей: для сообщений, которые
  вы посылаете своему собеседнику и сообщений, которые он посылает вам. Если вы
  и ваш собеседник одновременно зашифруете и отправите сообщения, ключ будет
  использован дважды, что крайне небезопасно.
- Если злоумышленник узнает часть ключа/сообщения, он может подменить эту часть
  сообщения. Чтобы проверить подлинность сообщения, используйте контрольную
  сумму. Помните, что она не защищает от подделки в случаях, когда
  злоумышленнику известен весь ключ.
- Значение сообщения "The hash sum was added/wrong" зависит от ситуации. Если вы
  получаете его при шифровании данных, это означает, что к данным была добавлена
  контрольная сумма, в этом случае волноваться не надо. Если вы получаете данное
  сообщение при расшифровке данных, то это означает, что они были изменены.
- При шифровании файлов следите, чтобы свободной оперативной памяти было больше,
  чем размер файла, умноженный на 3. Указание необходимого действия с
  контрольной суммой и/или сжатия данных может сократить время.
- Программа может использоваться в случае, если есть 2 канала, каждый из которых
  в отдельности может прослушиваться. Тогда надо передавать ключи по одному
  каналу, а сообщения - по другому. Чтобы расшифровать сообщения, потребуется
  прослушать оба канала.
- Надежность шифра зависит от безопасности способа передачи ключей.
  Рекомендуется передавать ключи при личной встрече на флешке или диске. Для
  большей надежности можно шифровать ключи с помощью truecrypt, зашифрованных
  zip-архивов и т.д.
- Учтите, что кириллические символы могут занимать больше 1 байта.
- В некоторых случаях уничтожение использованных ключей может работать
  неправильно. Это описано в документации Gnu Shred.
- Сжатие может уменьшить объем текстовых данных в несколько раз.
- Про шифр Вернама можно [почитать на
  Википедии](http://ru.wikipedia.org/wiki/Шифр_Вернама)
- Если вы заметили ошибку в программе, у вас возникли вопросы или вы хотите
  предложить какие-то улучшения, не стесняйтесь связаться со мной по
  [электронной почте](mailto:anton-tsyganenko@yandex.ru) или
  [jabber](xmpp:antontsyganenko@jabber.ru).
